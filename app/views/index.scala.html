@(tasks: List[Task], taskForm: Form[String])

@import helper._

@main("Todo list") {
    
    <h1>@tasks.size tasks(s)</h1>
    
    <ul id="tasks">
        
        @tasks.map { task =>
            <li id="task_@{task.id}" data-id="@{task.id}">
                <input type="checkbox" class="checkTask" @{if(task.id ==4) "checked"}>
               <span class ="label_@{task.id}"> @task.label</span> 

                <span class ="editTask">[edit]</span>
               <span class ="deleteTask">[delete]</span>

                <!--Form 
               [atmark]form(routes.Application.deleteTask(task.id)){
                    <input type="submit" value="Delete" class="deleteTask">
                }-->
                <span class ="drag">[drag]</span>

               
        }
    </ul>
    
    <h2>Add a new task</h2>
    @form(routes.Application.newTask) {
        @inputText(taskForm("label"))
        <input type="submit" value="Create">
    }
}



<script>
$(function() {
 
    //CHECKBOX
    $(document).on('click', '.checkTask', function() {
        var id = $(this).parent().data('id');
        //alert(id);
        var title = $(this).next();
        console.log(title);
        
        /*$.post('_ajax_check_task.php', {
            id: id
        }, function(rs) {*/
            if (title.hasClass('done')) {
                title.removeClass('done');
                alert("remove done");
            } else {
                title.addClass('done');
                alert("add done");
            }
      //  });
    });



    //Delete Form button
    $(document).on('click', '.deleteTask', function() {
        if (confirm('本当に削除しますか？')) {
            var id = $(this).parent().data('id');
               var label = $(this).prev().val();

        
            $.post('/tasks/' + id + '/delete', {
                id: id
                
            }, function(rs) {
                $('#task_'+id).fadeOut(800);
            });
        }
    });

      
            
 
 

    //SORTABLE
    $('#tasks').sortable({
        axis: 'y',
        opacity: 0.2,
        handle: '.drag',
        update: function() {
          /*  $.post('_ajax_sort_task.php', {
                task: $(this).sortable('serialize')
            });*/
        }
    });

    //edit 項目名はjQueryでDOMからみつけてくる。データベースは利用していない
     $(document).on('click', '.editTask', function() {
        var id = $(this).parent().data('id');
        //console.log(id);
        var title = $(this).prev().text();

       // alert(title);
        $('#task_'+id)
            .empty()
            .append($('<input type="text">').attr('value',title))
            .append('<input type="button" value="更新" class="updateTask">');
            

            /*.append([atmark]form(routes.Application.updateTask(11)){
                    <input type="submit" value="Update" class="updateTask">
                })*/



            //フォーカスあてる
        $('#task_'+id+' input:eq(0)').focus();
    });

//update Editボタンをおされて編集したあと更新ボタンがおされた処理
     $(document).on('click', '.updateTask', function() {
        //id,titleをDOM構造からjQueryでひっぱってくる
        var id = $(this).parent().data('id');
        var label = $(this).prev().val();
        //alert(title);
        $.post('/tasks/' + id + '/update', {
            id: id,
            label:label
        }, function(rs) {
            
            var e = $(
               //after update
                '<input type="checkbox" class="checkTask">'+
               '<span class =""></span> '+

               ' <span class ="editTask">[edit]</span>'+
              
              '  <span class ="drag">[drag]</span>'
            );
            $('#task_'+id).empty().append(e).find('span:eq(0)').text(label);
        });
    });
    





});
</script>
<style>
    .deleteTask ,.drag,.editTask{
        cursor: pointer;
        color: blue;
    }

     .done {
        text-decoration: line-through;
        color: gray;
    }
    </style>


             
              
              
               